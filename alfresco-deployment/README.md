# Alfresco Community with Markdown Rendition

This project provides an Alfresco Content Services environment using Docker Compose, extended with the [alfresco-markdown-rendition](https://github.com/aborroy/alfresco-markdown-rendition) module.

The extension introduces support for generating **Markdown renditions** of content stored in the repository. It requires a new transformer service (`transform-md`) based on [alf-tengine-convert2md](https://github.com/aborroy/alf-tengine-convert2md) and a local Ollama instance with the `llava` model.

## Architecture

```
+----------------------+           +-------------------+
|      Alfresco        |  <----->  |  transform-md     |
|   (Repository)       |           |  (Markdown engine)|
|                      |           |                   |
|  - alfresco-markdown |           |  Uses Ollama +    |
|    -rendition module |           |  LLaVA model      |
+----------------------+           +-------------------+
          |
          v
   Markdown Renditions
```

## Requirements

* Docker and Docker Compose
* Local Ollama runtime with the `llava` model installed

  ```bash
  ollama pull llava
  ```
* Ports

  * Alfresco webapps (`8080`)
  * Ollama API (`11434`)

## Services

### `alfresco`

The standard Alfresco Repository service, extended with the Markdown rendition module

Extra configuration added to `JAVA_OPTS`

```properties
-DlocalTransform.md.url=http://transform-md:8090/
```

This tells Alfresco where to reach the Markdown transformer service

### `transform-md`

A transformer service to convert documents into Markdown

```yaml
transform-md:
  image: docker.io/angelborroy/alf-tengine-convert2md
  environment:
    SPRING_AI_OLLAMA_BASE_URL: http://host.docker.internal:11434
```

* Uses [alf-tengine-convert2md](https://github.com/aborroy/alf-tengine-convert2md)
* Relies on Ollama running locally at `http://localhost:11434`
* Requires the `llava` model to generate conversions

## Usage

1. Start Ollama locally (on your host machine)

   ```bash
   ollama serve
   ```

   Ensure you have pulled the `llava` model

   ```bash
   ollama pull llava
   ```

2. Start the Docker environment:

   ```bash
   docker compose up -d --build
   ```

3. Access Alfresco:

   * Repository: [http://localhost:8080/alfresco](http://localhost:8080/alfresco)
   * Share: [http://localhost:8080/share](http://localhost:8080/share)

> Use default credentials `admin`/`admin`   

## Notes

The Markdown transformer (`transform-md`) depends on Ollama running locally. If Ollama is not started, Markdown rendition requests will fail

This setup is based on the default configuration generated by [alfresco-docker-installer](https://github.com/alfresco/alfresco-docker-installer), with the addition of:

  * `alfresco-markdown-rendition` extension in the Repository service
  * A new `transform-md` service
  * Repository configuration `-DlocalTransform.md.url=http://transform-md:8090/`

## References

* [Alfresco Docker Installer](https://github.com/alfresco/alfresco-docker-installer)
* [alfresco-markdown-rendition](https://github.com/aborroy/alfresco-markdown-rendition)
* [alf-tengine-convert2md](https://github.com/aborroy/alf-tengine-convert2md)
* [Ollama](https://ollama.ai)